<?xml version='1.0' encoding='iso-8859-1' standalone='no'?>
<!DOCTYPE issue SYSTEM "lwg-issue.dtd" [ 
  <!ENTITY nbsp "&#160;">
] >

<issue num="2100" status="New">
<title>timed waiting functions cannot timeout if <tt>launch::async</tt> policy used</title>
<section><sref ref="[futures.async]"/></section>
<submitter>Jonathan Wakely</submitter>
<date>14 Nov 2011</date>

<discussion>

<p>
<sref ref="[futures.async]"/> p5 says
</p>

<blockquote>
<p>
If the implementation chooses the <tt>launch::async</tt> policy,
</p>
<ul><li>a call to a waiting function on an asynchronous return object that shares the 
shared state created by this <tt>async</tt> call shall block until the associated thread has
completed, as if joined (<sref ref="[thread.thread.member]"/>);</li>
</ul>
</blockquote>

<p>
That should say a non-timed waiting function, otherwise, calling a timed waiting function 
can block indefinitely waiting for the associated thread to complete, rather than timing 
out after the specified time.
<p/>
Since <tt>std::thread</tt> does not provide a <tt>timed_join()</tt> function (nor does
Pthreads, making it impossible on many platforms) there is no way for a timed waiting 
function to try to join but return early due to timeout, therefore timed waiting 
functions either cannot guarantee to timeout or cannot be used to meet the requirement 
to block until the thread is joined.  In order to allow timed waiting functions to
timeout the requirement should only apply to non-timed waiting functions.
</p>

</discussion>

<resolution>
<p>This wording is relative to the FDIS.</p>

<p>Change <sref ref="[futures.async]"/> p5 as indicated:</p>

<blockquote>
<p>
If the implementation chooses the <tt>launch::async</tt> policy,
</p>
<ul><li>a call to a <ins>non-timed</ins> waiting function on an asynchronous return object 
that shares the shared state created by this <tt>async</tt> call shall block until the 
associated thread has completed, as if joined (<sref ref="[thread.thread.member]"/>);</li>
</ul>
</blockquote>

</resolution>

</issue>
